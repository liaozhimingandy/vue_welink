"use strict";(self["webpackChunkweb"]=self["webpackChunkweb"]||[]).push([[593],{9371:function(e,t){const a=12e4,l={moment_lasted:"/api/moment/moments/lasted/",moment_push:"/api/moment/moments/",authorize:"/api/v2/user/oauth/authorize/"};t["Z"]={apis:l,refresh:a}},3558:function(e,t,a){a.d(t,{Z:function(){return w}});var l=a(3396),n=a(7139),i=a(4870),o=a(2748);const s=["src"],u={class:"el-upload-list__item-actions"},r=["onClick"],d=["onClick"],m={class:"el-upload__tip"},c=["src"];var p={__name:"ImageUpload",setup(e,{expose:t}){const a=(0,i.iH)(9),p=(0,i.iH)(""),g=(0,i.iH)(!1),_=(0,i.iH)(!1),w=(0,i.iH)([]),f=(0,i.iH)(90),v=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],h="http://127.0.0.1:8000/api/moment/image/upload/",W={Authorization:"Bearer "+localStorage.getItem("access_token")};function D(){_.value=w.value.length===a.value}function k(e,t){w.value=t,D()}const y=e=>{const t=w.value;for(const a in t)t[a].uid===e.uid&&t.splice(a,1);w.value=t,D()},x=e=>{p.value=e.url,g.value=!0},b=e=>{console.info(e)},U=e=>{console.log(e)};return t({list_images:w}),(e,t)=>{const D=(0,l.up)("el-icon"),H=(0,l.up)("el-progress"),z=(0,l.up)("el-upload"),S=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(z,{class:(0,n.C_)({hide:_.value}),name:"image",action:h,headers:W,"list-type":"picture-card",limit:a.value,"file-list":w.value,"show-file-list":!0,"on-change":k,"auto-upload":!0,"on-progress":b,accept:"image/*","on-success":U,multiple:""},{file:(0,l.w5)((({file:e})=>[(0,l._)("div",null,[(0,l._)("img",{class:"el-upload-list__item-thumbnail",src:e.url,alt:""},null,8,s),(0,l._)("span",u,[(0,l._)("span",{class:"el-upload-list__item-preview",onClick:t=>x(e)},[(0,l.Wm)(D,null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(o.DYM))])),_:1})],8,r),(0,l._)("span",{class:"el-upload-list__item-delete",onClick:t=>y(e)},[(0,l.Wm)(D,null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(o.HG3))])),_:1})],8,d)]),(0,l.Wm)(H,{type:"circle",percentage:f.value,color:v,class:"progress",style:{display:"none"}},null,8,["percentage"])])])),tip:(0,l.w5)((()=>[(0,l._)("div",m,"最多上传"+(0,n.zw)(a.value)+"张图片,且单张图片大小不能超过10MB",1)])),default:(0,l.w5)((()=>[(0,l.Wm)(D,null,{default:(0,l.w5)((()=>[(0,l.Wm)((0,i.SU)(o.v37))])),_:1})])),_:1},8,["class","limit","file-list"]),(0,l.Wm)(S,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e)},{default:(0,l.w5)((()=>[(0,l._)("img",{src:p.value,alt:"Preview Image",style:{"max-width":"100%"}},null,8,c)])),_:1},8,["modelValue"])],64)}}},g=a(89);const _=(0,g.Z)(p,[["__scopeId","data-v-14bac546"]]);var w=_},6593:function(e,t,a){a.r(t),a.d(t,{default:function(){return I}});a(7658),a(541);var l=a(3396),n=a(4870),i=a(9242),o=a(7139),s=a(2748),u=a(6666);const r={class:"SongList"};var d={__name:"PictureList",props:["images"],setup(e){const t=e,a=(0,n.qj)({MinDisplay:(0,n.iH)("flex"),ShowIndex:(0,n.iH)(0),display:(0,n.iH)("none")}),i=(0,l.Fl)((()=>{let e,a=[];for(e in t.images)a.push(t.images[e]);return a}));return(t,s)=>{const u=(0,l.up)("el-image");return(0,l.wg)(),(0,l.iD)("div",r,[(0,l._)("div",{class:"covers",style:(0,o.j5)({display:a.MinDisplay})},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.images,((e,t)=>((0,l.wg)(),(0,l.iD)("div",{class:"cover",key:t},[(0,l.Wm)(u,{style:{width:"97%",height:"200px"},class:"min",src:e,"preview-src-list":(0,n.SU)(i),"initial-index":t,fit:"cover"},null,8,["src","preview-src-list","initial-index"])])))),128))],4)])}}},m=a(89);const c=(0,m.Z)(d,[["__scopeId","data-v-21e86ac8"]]);var p=c;const g=e=>((0,l.dD)("data-v-97523346"),e=e(),(0,l.Cn)(),e),_={class:"radius"},w=g((()=>(0,l._)("img",{src:""},null,-1)));var f={__name:"MomentDetail",props:["item"],setup(e){const t=e=>{function t(e){return(1==String(e).length?"0":"")+e}const a=parseInt(((new Date).getTime()/1e3).toString()),l=a-e,n=new Date(1e3*a),i=new Date(1e3*e),o=i.getFullYear(),s=i.getMonth()+1,u=i.getDate(),r=i.getHours(),d=i.getMinutes();if(l<60)return"刚刚";if(l<3600)return Math.floor(l/60)+"分钟前";if(n.getFullYear()==o&&n.getMonth()+1==s&&n.getDate()==u)return"今天"+t(r)+":"+t(d);var m=new Date(1e3*(a-86400));return m.getFullYear()==o&&m.getMonth()+1==s&&m.getDate()==u?"昨天"+t(r)+":"+t(d):n.getFullYear()==o?t(s)+"月"+t(u)+"日 "+t(r)+":"+t(d):o+"年"+t(s)+"月"+t(u)+"日 "+t(r)+":"+t(d)},a=e=>{e.liked=e.liked+1};return(i,u)=>{const r=(0,l.up)("el-avatar"),d=(0,l.up)("el-col"),m=(0,l.up)("el-row"),c=(0,l.up)("el-divider"),g=(0,l.up)("el-button");return(0,l.wg)(),(0,l.iD)("div",_,[(0,l.Wm)(m,{align:"middle",style:{padding:"3px 3px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{xs:5,sm:3,md:3,lg:2,xl:1},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{size:60},{default:(0,l.w5)((()=>[w])),_:1})])),_:1}),(0,l.Wm)(d,{style:{"text-align":"left"},xs:19,sm:21,md:21,lg:22,xl:23},{default:(0,l.w5)((()=>[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(""==e.item.nick_name||null==e.item.nick_name?e.item.username:e.item.nick_name)+"•"+(0,o.zw)(t(Date.parse(e.item.gmt_created)/1e3))+(0,o.zw)(null==e.item.from_ip||""==e.item.from_ip?"":"•"+e.item.from_ip),1)])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Uk)("@"+(0,o.zw)(e.item.username),1)])),_:1})])),_:1})])),_:1}),(0,l.Wm)(m,{style:{"text-align":"left","padding-left":"63px","background-color":"#e9ebee"}},{default:(0,l.w5)((()=>[(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.item.moment),1)])),_:1}),(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Wm)(p,{images:e.item.images},null,8,["images"])])),_:1})])),_:1}),(0,l.Wm)(m,{style:{"text-align":"left","padding-left":"63px","padding-top":"3px"}},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.item.loc),1)])),_:1}),(0,l.Wm)(c,{style:{margin:"10px 0"}}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g,{type:"danger",text:"",icon:(0,n.SU)(s.RhE),onClick:u[0]||(u[0]=t=>a(e.item))},{default:(0,l.w5)((()=>[(0,l.Uk)("赞("+(0,o.zw)(e.item.liked)+")",1)])),_:1},8,["icon"])])),_:1})])),_:1})])}}};const v=(0,m.Z)(f,[["__scopeId","data-v-97523346"]]);var h=v,W=a(3558),D=a(9371),k=a(1333);const y=e=>((0,l.dD)("data-v-4b982d91"),e=e(),(0,l.Cn)(),e),x=y((()=>(0,l._)("div",{class:"flex-grow"},null,-1))),b=y((()=>(0,l._)("a",{href:"mailto:liaozhimingandy@qq.com"},"意见反馈(使用邮件反馈)",-1))),U=y((()=>(0,l._)("a",{href:"/privacy"},"关于隐私",-1))),H={class:"bottom"},z=y((()=>(0,l._)("div",{style:{"margin-top":"8px",color:"#6c757d","font-size":"12px"}},[(0,l._)("span",null,"版本号: 0.1")],-1)));var S={__name:"HomeView",setup(e){const t=(0,n.qj)({data:"",currentDate:"",btn_type:"danger",timer:null}),a=(0,n.qj)({data:[]}),r=(0,l.f3)("$axios"),d=(0,n.iH)("1"),m=(0,n.iH)(!1),c=(0,n.iH)();function p(){return 0===t.data.trim().length}const g=async()=>{t.btn_type="success";let e=[];m.value&&c.value.list_images.forEach((function(t){e.push(t.response.image_path)}));let l={moment:t.data,gmt_created:new Date,user_name:"anonymous",nick_name:localStorage.getItem("nick_name"),loc:"中国",from_device:"iphone 13",from_ip:"",images:e,liked:0,right_status:0,content_class:0,uid:localStorage.getItem("uid")};await r({url:D.Z.apis.moment_push,method:"post",data:l}).then((e=>{t.currentDate=e.gmt_created})).catch((e=>{console.log(e.response.data),console.log(e.code)})),m.value&&(e=[],c.value.list_images.forEach((function(t){e.push(t.response.url)}))),l.images=e,a.data.unshift(l),t.data="",t.btn_type="danger",m.value&&(c.value.list_images=[],m.value=!1)};(0,l.bv)((()=>{_(),t.timer=setInterval((function(){_()}),D.Z.refresh),t.timer=setInterval((function(){t.currentDate=f(new Date)}),800)})),(0,l.Jd)((()=>{for(let e in t.timer)clearInterval(e)}));const _=async()=>{await r({url:D.Z.apis.moment_lasted,method:"get",data:null}).then((e=>{if(0===e.length)return;let t=e;t.sort((function(e,t){let a=e["mid"],l=t["mid"];return a<l?-1:a>l?1:0})),t.forEach((function(e){a.data.unshift(e)})),a.data=w(a.data,"mid"),(0,u.bM)({title:"动态更新通知",message:"共加载"+t.length+"条数据",type:"success",position:"bottom-right"})})).catch((e=>{console.log(e.code)}))};function w(e,t){for(var a=[],l={},n=0;n<e.length;n++)l[e[n][t]]||(a.push(e[n]),l[e[n][t]]=1);return a}const f=e=>{let t=new Date(e).getFullYear(),a=new Date(e).getMonth()+1<10?"0"+(new Date(e).getMonth()+1):new Date(e).getMonth()+1,l=new Date(e).getDate()<10?"0"+new Date(e).getDate():new Date(e).getDate(),n=new Date(e).getHours()<10?"0"+new Date(e).getHours():new Date(e).getHours(),i=new Date(e).getMinutes()<10?"0"+new Date(e).getMinutes():new Date(e).getMinutes(),o=new Date(e).getSeconds()<10?"0"+new Date(e).getSeconds():new Date(e).getSeconds();var s=new Date(e).getDay();let u;return 0===s?u="日":1===s?u="一":2===s?u="二":3===s?u="三":4===s?u="四":5===s?u="五":6===s&&(u="六"),t+"-"+a+"-"+l+"   "+n+":"+i+":"+o+"   星期"+u},v=()=>{localStorage.clear(),(0,u.bM)({title:"温馨提示",message:"已安全退出登录",type:"success",position:"top-right"}),k.Z.push("login/")};return(e,u)=>{const r=(0,l.up)("el-menu-item"),_=(0,l.up)("el-button"),w=(0,l.up)("el-sub-menu"),f=(0,l.up)("el-menu"),D=(0,l.up)("el-header"),k=(0,l.up)("el-card"),y=(0,l.up)("el-aside"),S=(0,l.up)("el-input"),M=(0,l.up)("el-divider"),I=(0,l.up)("el-icon"),C=(0,l.up)("el-tooltip"),Z=(0,l.up)("el-alert"),Y=(0,l.up)("el-main"),F=(0,l.up)("el-container"),V=(0,l.up)("el-backtop");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Wm)(D,{style:{padding:"0"}},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{"default-active":d.value,class:"el-menu-demo",mode:"horizontal",ellipsis:!1},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{disabled:""},{default:(0,l.w5)((()=>[(0,l.Uk)("logo")])),_:1}),x,(0,l.Wm)(r,{index:"1"},{default:(0,l.w5)((()=>[(0,l.Uk)("首页")])),_:1}),(0,l.Wm)(w,{index:"2"},{title:(0,l.w5)((()=>[(0,l.Uk)("更多")])),default:(0,l.w5)((()=>[(0,l.Wm)(r,{index:"2-1"},{default:(0,l.w5)((()=>[b])),_:1}),(0,l.Wm)(r,{index:"2-2"},{default:(0,l.w5)((()=>[U])),_:1}),(0,l.Wm)(r,{index:"2-3"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{link:"",onClick:v},{default:(0,l.w5)((()=>[(0,l.Uk)("退出登录")])),_:1})])),_:1})])),_:1})])),_:1},8,["default-active"])])),_:1}),(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Wm)(y,{class:"hidden-md-and-down"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{shadow:"hover"},{default:(0,l.w5)((()=>[(0,l.Uk)("首页")])),_:1})])),_:1}),(0,l.Wm)(Y,{style:{"padding-top":"0"}},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{shadow:"hover"},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{modelValue:t.data,"onUpdate:modelValue":u[0]||(u[0]=e=>t.data=e),placeholder:"分享你的新鲜事给大家吧",autosize:{minRows:2,maxRows:6},type:"textarea",maxlength:"512",size:"large","show-word-limit":"",clearable:""},null,8,["modelValue"]),(0,l.wy)((0,l._)("div",null,[(0,l.Wm)((0,n.SU)(W.Z),{ref_key:"image_upload",ref:c},null,512),(0,l.Wm)(M)],512),[[i.F8,m.value]]),(0,l._)("div",H,[(0,l.Wm)(C,{effect:"dark",content:"轻触来上传图片",placement:"top"},{default:(0,l.w5)((()=>[(0,l._)("span",null,[(0,l.Wm)(_,{size:"large",link:"",onClick:u[1]||(u[1]=e=>m.value=!m.value),id:"btn-images-upload"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{size:28},{default:(0,l.w5)((()=>[(0,l.Wm)((0,n.SU)(s.tap))])),_:1})])),_:1})])])),_:1}),(0,l.Wm)(_,{type:t["btn_type"],icon:(0,n.SU)(s.LWA),onClick:g,disabled:p()},{default:(0,l.w5)((()=>[(0,l.Uk)("发布")])),_:1},8,["type","icon","disabled"])])])),_:1}),(0,l.Wm)(Z,{title:"目前为开发阶段,所有数据均保存为你的本地,刷新浏览器即消失,欢迎使用!",type:"warning",effect:"dark",closable:!1,style:{"margin-top":"6px"}}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.data,((e,t)=>((0,l.wg)(),(0,l.j4)((0,n.SU)(h),{key:t,item:e},null,8,["item"])))),128))])),_:1}),(0,l.Wm)(y,{class:"hidden-md-and-down",style:{"padding-right":"8px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{shadow:"hover"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(t.currentDate),1)])),_:1}),(0,l.Wm)(k,{shadow:"hover"},{default:(0,l.w5)((()=>[(0,l.Uk)("人人都是产品经理,请把你想要的功能告诉我们!")])),_:1}),z])),_:1})])),_:1})])),_:1}),(0,l.Wm)(V,{right:100,bottom:100})],64)}}};const M=(0,m.Z)(S,[["__scopeId","data-v-4b982d91"]]);var I=M}}]);
//# sourceMappingURL=593.1c13f872.js.map